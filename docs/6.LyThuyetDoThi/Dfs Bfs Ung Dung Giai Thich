# ğŸ“˜ DFS & BFS: á»¨ng dá»¥ng, vÃ­ dá»¥, giáº£i thÃ­ch chi tiáº¿t
# ===============================================
"""
DFS (Depth-First Search) vÃ  BFS (Breadth-First Search) lÃ  hai thuáº­t toÃ¡n cÆ¡ báº£n nháº¥t
trong lÃ½ thuyáº¿t Ä‘á»“ thá»‹, vá»›i nhiá»u á»©ng dá»¥ng quan trá»ng trong ICPC:

1. Äáº·c Ä‘iá»ƒm chÃ­nh:
   - DFS: Äi sÃ¢u nháº¥t cÃ³ thá»ƒ theo má»™t nhÃ¡nh trÆ°á»›c khi quay lui
   - BFS: Duyá»‡t theo tá»«ng lá»›p, tá»« gáº§n Ä‘áº¿n xa

2. So sÃ¡nh:
   - DFS: DÃ¹ng stack (Ä‘á»‡ quy), tá»‘t cho bÃ i toÃ¡n cáº§n Ä‘i sÃ¢u
   - BFS: DÃ¹ng queue, tá»‘t cho bÃ i toÃ¡n cáº§n tÃ¬m Ä‘Æ°á»ng ngáº¯n nháº¥t

3. Äá»™ phá»©c táº¡p:
   - Thá»i gian: O(V + E) vá»›i V Ä‘á»‰nh, E cáº¡nh
   - KhÃ´ng gian: O(V) cho visited array
   - DFS: O(V) cho stack (Ä‘á»‡ quy)
   - BFS: O(V) cho queue
"""

from collections import deque

# ========= VÃ Dá»¤ Äá»’ THá»Š =========
"""
Äá»“ thá»‹ vÃ´ hÆ°á»›ng khÃ´ng trá»ng sá»‘:
    0
   / \
  1   2
  |   |
  3 - 4
  |
  5
"""
graph = {
    0: [1, 2],
    1: [0, 3],
    2: [0, 3, 4],
    3: [1, 2, 4, 5],
    4: [2, 3],
    5: [3]
}

# ========= DFS CHI TIáº¾T =========
"""
DFS (Depth-First Search):
1. CÃ¡ch hoáº¡t Ä‘á»™ng:
   - Báº¯t Ä‘áº§u tá»« má»™t Ä‘á»‰nh
   - Äi sÃ¢u nháº¥t cÃ³ thá»ƒ theo má»™t nhÃ¡nh
   - Quay lui khi gáº·p Ä‘á»‰nh Ä‘Ã£ thÄƒm
   - Tiáº¿p tá»¥c vá»›i nhÃ¡nh khÃ¡c

2. á»¨ng dá»¥ng:
   - Kiá»ƒm tra liÃªn thÃ´ng
   - TÃ¬m chu trÃ¬nh
   - Topological sort
   - Backtracking
   - TÃ¬m thÃ nh pháº§n liÃªn thÃ´ng
   - Kiá»ƒm tra Ä‘á»“ thá»‹ hai phÃ­a
"""

# 1. DFS cÆ¡ báº£n
visited_dfs = [False] * len(graph)
def dfs(u):
    """
    DFS tá»« Ä‘á»‰nh u
    
    Tham sá»‘:
    - u: Ä‘á»‰nh báº¯t Ä‘áº§u duyá»‡t
    
    CÃ¡ch hoáº¡t Ä‘á»™ng:
    1. ÄÃ¡nh dáº¥u Ä‘á»‰nh u Ä‘Ã£ thÄƒm
    2. Duyá»‡t Ä‘á»‡ quy cÃ¡c Ä‘á»‰nh ká» chÆ°a thÄƒm
    3. In ra thá»© tá»± thÄƒm
    """
    print("DFS thÄƒm:", u)
    visited_dfs[u] = True
    for v in graph[u]:
        if not visited_dfs[v]:
            dfs(v)

# 2. DFS vá»›i thá»i gian vÃ o/ra
time_in = [0] * len(graph)
time_out = [0] * len(graph)
timer = 0
def dfs_timer(u):
    """
    DFS vá»›i thá»i gian vÃ o/ra cá»§a má»—i Ä‘á»‰nh
    
    á»¨ng dá»¥ng:
    - Kiá»ƒm tra Ä‘á»‰nh con trong cÃ¢y DFS
    - TÃ¬m cáº¡nh ngÆ°á»£c (back edge)
    - PhÃ¡t hiá»‡n chu trÃ¬nh
    """
    global timer
    time_in[u] = timer
    timer += 1
    for v in graph[u]:
        if time_in[v] == 0:  # ChÆ°a thÄƒm
            dfs_timer(v)
    time_out[u] = timer
    timer += 1

# 3. DFS tÃ¬m chu trÃ¬nh
def has_cycle():
    """
    Kiá»ƒm tra Ä‘á»“ thá»‹ cÃ³ chu trÃ¬nh khÃ´ng
    
    CÃ¡ch hoáº¡t Ä‘á»™ng:
    1. DÃ¹ng DFS vá»›i 3 tráº¡ng thÃ¡i:
       - 0: chÆ°a thÄƒm
       - 1: Ä‘ang thÄƒm (trong stack)
       - 2: Ä‘Ã£ thÄƒm xong
    2. Náº¿u gáº·p Ä‘á»‰nh Ä‘ang thÄƒm â†’ cÃ³ chu trÃ¬nh
    """
    state = [0] * len(graph)  # 0: chÆ°a thÄƒm, 1: Ä‘ang thÄƒm, 2: Ä‘Ã£ thÄƒm xong
    
    def dfs_cycle(u):
        state[u] = 1  # Äang thÄƒm
        for v in graph[u]:
            if state[v] == 0:  # ChÆ°a thÄƒm
                if dfs_cycle(v):
                    return True
            elif state[v] == 1:  # Äang thÄƒm â†’ cÃ³ chu trÃ¬nh
                return True
        state[u] = 2  # ÄÃ£ thÄƒm xong
        return False
    
    for u in range(len(graph)):
        if state[u] == 0 and dfs_cycle(u):
            return True
    return False

# ========= BFS CHI TIáº¾T =========
"""
BFS (Breadth-First Search):
1. CÃ¡ch hoáº¡t Ä‘á»™ng:
   - Báº¯t Ä‘áº§u tá»« má»™t Ä‘á»‰nh
   - Duyá»‡t theo tá»«ng lá»›p
   - Lá»›p i: cÃ¡c Ä‘á»‰nh cÃ¡ch Ä‘á»‰nh gá»‘c i cáº¡nh
   - DÃ¹ng queue Ä‘á»ƒ quáº£n lÃ½ cÃ¡c Ä‘á»‰nh

2. á»¨ng dá»¥ng:
   - TÃ¬m Ä‘Æ°á»ng Ä‘i ngáº¯n nháº¥t (unweighted)
   - Kiá»ƒm tra Ä‘á»“ thá»‹ hai phÃ­a
   - TÃ¬m thÃ nh pháº§n liÃªn thÃ´ng
   - Maze solver
   - Web crawling
"""

# 1. BFS cÆ¡ báº£n
visited_bfs = [False] * len(graph)
dist_bfs = [-1] * len(graph)
def bfs(start):
    """
    BFS tá»« Ä‘á»‰nh start
    
    Tham sá»‘:
    - start: Ä‘á»‰nh báº¯t Ä‘áº§u duyá»‡t
    
    CÃ¡ch hoáº¡t Ä‘á»™ng:
    1. Khá»Ÿi táº¡o queue vá»›i Ä‘á»‰nh start
    2. Láº¥y Ä‘á»‰nh tá»« queue, thÄƒm cÃ¡c Ä‘á»‰nh ká»
    3. Cáº­p nháº­t khoáº£ng cÃ¡ch vÃ  thÃªm vÃ o queue
    """
    q = deque()
    visited_bfs[start] = True
    dist_bfs[start] = 0
    q.append(start)
    
    while q:
        u = q.popleft()
        print("BFS thÄƒm:", u, "khoáº£ng cÃ¡ch:", dist_bfs[u])
        for v in graph[u]:
            if not visited_bfs[v]:
                visited_bfs[v] = True
                dist_bfs[v] = dist_bfs[u] + 1
                q.append(v)

# 2. BFS tÃ¬m Ä‘Æ°á»ng Ä‘i
def bfs_path(start, end):
    """
    TÃ¬m Ä‘Æ°á»ng Ä‘i ngáº¯n nháº¥t tá»« start Ä‘áº¿n end
    
    Tráº£ vá»:
    - ÄÆ°á»ng Ä‘i ngáº¯n nháº¥t (list)
    - -1 náº¿u khÃ´ng cÃ³ Ä‘Æ°á»ng Ä‘i
    """
    q = deque()
    visited = [False] * len(graph)
    parent = [-1] * len(graph)
    
    visited[start] = True
    q.append(start)
    
    while q:
        u = q.popleft()
        if u == end:
            # TÃ¬m Ä‘Æ°á»ng Ä‘i
            path = []
            while u != -1:
                path.append(u)
                u = parent[u]
            return path[::-1]
        
        for v in graph[u]:
            if not visited[v]:
                visited[v] = True
                parent[v] = u
                q.append(v)
    
    return -1

# 3. BFS trong maze 2D
def solve_maze(maze, start, end):
    """
    TÃ¬m Ä‘Æ°á»ng Ä‘i trong mÃª cung 2D
    
    Tham sá»‘:
    - maze: ma tráº­n 2D (0: Ä‘Æ°á»ng Ä‘i, 1: tÆ°á»ng)
    - start: tá»a Ä‘á»™ báº¯t Ä‘áº§u (x, y)
    - end: tá»a Ä‘á»™ káº¿t thÃºc (x, y)
    
    Tráº£ vá»:
    - ÄÆ°á»ng Ä‘i ngáº¯n nháº¥t
    - -1 náº¿u khÃ´ng cÃ³ Ä‘Æ°á»ng Ä‘i
    """
    n, m = len(maze), len(maze[0])
    visited = [[False]*m for _ in range(n)]
    parent = [[None]*m for _ in range(n)]
    
    # 4 hÆ°á»›ng: lÃªn, pháº£i, xuá»‘ng, trÃ¡i
    dx = [-1, 0, 1, 0]
    dy = [0, 1, 0, -1]
    
    q = deque([start])
    visited[start[0]][start[1]] = True
    
    while q:
        x, y = q.popleft()
        if (x, y) == end:
            # TÃ¬m Ä‘Æ°á»ng Ä‘i
            path = []
            while (x, y) != start:
                path.append((x, y))
                x, y = parent[x][y]
            path.append(start)
            return path[::-1]
        
        for i in range(4):
            nx, ny = x + dx[i], y + dy[i]
            if (0 <= nx < n and 0 <= ny < m and 
                not visited[nx][ny] and maze[nx][ny] == 0):
                visited[nx][ny] = True
                parent[nx][ny] = (x, y)
                q.append((nx, ny))
    
    return -1

# ========= á»¨NG Dá»¤NG THá»°C Táº¾ =========
"""
1. BÃ i toÃ¡n ICPC phá»• biáº¿n:
   - TÃ¬m Ä‘Æ°á»ng Ä‘i ngáº¯n nháº¥t (BFS)
   - Kiá»ƒm tra liÃªn thÃ´ng (DFS/BFS)
   - TÃ¬m chu trÃ¬nh (DFS)
   - Maze solver (BFS)
   - Topological sort (DFS)
   - Kiá»ƒm tra Ä‘á»“ thá»‹ hai phÃ­a (BFS)

2. á»¨ng dá»¥ng thá»±c táº¿:
   - GPS navigation (BFS)
   - Web crawling (BFS)
   - Game AI pathfinding (BFS)
   - Dependency resolution (DFS)
   - Cycle detection (DFS)
   - Social network analysis (BFS/DFS)
"""

# ========= DEMO =========
if __name__ == "__main__":
    print("\n=== Demo DFS & BFS ===")
    
    print("\n1. DFS cÆ¡ báº£n:")
    dfs(0)
    
    print("\n2. DFS vá»›i thá»i gian:")
    dfs_timer(0)
    print("Thá»i gian vÃ o:", time_in)
    print("Thá»i gian ra:", time_out)
    
    print("\n3. Kiá»ƒm tra chu trÃ¬nh:")
    print("Äá»“ thá»‹ cÃ³ chu trÃ¬nh:", has_cycle())
    
    print("\n4. BFS cÆ¡ báº£n:")
    bfs(0)
    print("Khoáº£ng cÃ¡ch tá»« Ä‘á»‰nh 0:", dist_bfs)
    
    print("\n5. BFS tÃ¬m Ä‘Æ°á»ng Ä‘i:")
    path = bfs_path(0, 5)
    print("ÄÆ°á»ng Ä‘i tá»« 0 Ä‘áº¿n 5:", path)
    
    print("\n6. Demo maze solver:")
    maze = [
        [0, 1, 0, 0, 0],
        [0, 1, 0, 1, 0],
        [0, 0, 0, 1, 0],
        [1, 1, 1, 1, 0],
        [0, 0, 0, 0, 0]
    ]
    path = solve_maze(maze, (0, 0), (4, 4))
    if path != -1:
        print("ÄÆ°á»ng Ä‘i trong maze:", path)
    else:
        print("KhÃ´ng cÃ³ Ä‘Æ°á»ng Ä‘i")
    
    print("\nâœ… ÄÃ£ demo cÃ¡c á»©ng dá»¥ng cá»§a DFS & BFS")
    print("ğŸ’¡ HÃ£y thá»­ Ã¡p dá»¥ng vÃ o cÃ¡c bÃ i toÃ¡n thá»±c táº¿!")
